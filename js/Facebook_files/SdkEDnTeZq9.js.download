if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }

__d("LSInsertMessage",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(d){return b.i64.eq(a[2],[0,20])?b.db.table(12).add({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:a[6],senderId:a[10],isAdminMessage:a[12],sendStatus:a[14],sendStatusV2:a[15],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:a[7],stickerId:a[11],isUnsent:a[16],unsentTimestampMs:a[17],mentionOffsets:a[18],mentionLengths:a[19],mentionIds:a[20],mentionTypes:a[21],replySourceId:a[22],replySourceType:a[23],replySourceTypeV2:a[24],replyStatus:a[25],replySnippet:a[26],replyMessageText:a[27],replyToUserId:a[28],replyMediaExpirationTimestampMs:a[29],replyMediaUrl:a[30],replyMediaPreviewWidth:a[32],replyMediaPreviewHeight:a[33],replyMediaUrlMimeType:a[34],replyMediaUrlFallback:a[35],replyCtaId:a[36],replyCtaTitle:a[37],replyAttachmentType:a[38],replyAttachmentId:a[39],replyAttachmentExtra:a[40],forwardScore:a[41],hasQuickReplies:a[42],adminMsgCtaId:a[43],adminMsgCtaTitle:a[44],adminMsgCtaType:a[45],cannotUnsendReason:a[46],textHasLinks:a[47],viewFlags:a[48],displayedContentTypes:a[49],viewedPluginKey:a[50],viewedPluginContext:a[51],quickReplyType:a[52],hotEmojiSize:a[53],replySourceTimestampMs:a[54],ephemeralDurationInSec:a[55],msUntilExpirationTs:a[56],ephemeralExpirationTs:a[57]}):b.seq([function(d){return b.db.table(12).fetch([[[a[9]]],"optimistic"]).next().then(function(b,d){var f=b.done;b=b.value;return f?(f=[a[6],a[7],e],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(d=b.item,f=[d.primarySortKey,d.secondarySortKey,d.localDataId],c[0]=f[0],c[1]=f[1],c[2]=f[2],f)})},function(c){return b.fe(b.ftr(b.db.table(12).fetch([[[a[9]]],"optimistic"]),function(c){return c.offlineThreadingId===a[9]&&b.i64.lt(c.authorityLevel,a[2])}),function(a){return a["delete"]()})},function(d){return b.db.table(12).add({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:c[0],senderId:a[10],isAdminMessage:a[12],sendStatus:a[14],sendStatusV2:a[15],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:c[1],stickerId:a[11],isUnsent:a[16],unsentTimestampMs:a[17],mentionOffsets:a[18],mentionLengths:a[19],mentionIds:a[20],mentionTypes:a[21],replySourceId:a[22],replySourceType:a[23],replySourceTypeV2:a[24],replyStatus:a[25],replySnippet:a[26],replyMessageText:a[27],replyToUserId:a[28],replyMediaExpirationTimestampMs:a[29],replyMediaUrl:a[30],replyMediaPreviewWidth:a[32],replyMediaPreviewHeight:a[33],replyMediaUrlMimeType:a[34],replyMediaUrlFallback:a[35],replyCtaId:a[36],replyCtaTitle:a[37],replyAttachmentType:a[38],replyAttachmentId:a[39],replyAttachmentExtra:a[40],forwardScore:a[41],hasQuickReplies:a[42],adminMsgCtaId:a[43],adminMsgCtaTitle:a[44],adminMsgCtaType:a[45],cannotUnsendReason:a[46],textHasLinks:a[47],viewFlags:a[48],displayedContentTypes:a[49],viewedPluginKey:a[50],viewedPluginContext:a[51],quickReplyType:a[52],hotEmojiSize:a[53],replySourceTimestampMs:a[54],ephemeralDurationInSec:a[55],msUntilExpirationTs:a[56],ephemeralExpirationTs:a[57],localDataId:c[2]})}])},function(a){return b.resolve(d)}])}e.exports=a}),null);